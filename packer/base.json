{
  "builders": [
    {
      "type": "digitalocean",
      "api_token": "{{ env `DIGITALOCEAN_TOKEN` }}",
      "image": "ubuntu-18-04-x64",
      "region": "lon1",
      "size": "1gb",
      "ssh_username": "root",
      "snapshot_name": "base-image"
    }
  ],
  "provisioners": [
    {
      "type": "shell",
      "inline": [
        "sleep 30",
        "apt-get update",
        "apt-get upgrade",
        "useradd -m -s /bin/bash -G sudo  {{ env `USER` }}",
        "mkdir /home/{{ env `USER` }}/.ssh",
        "chown -R {{ env `USER` }}:{{ env `USER` }} /home/{{ env `USER` }}/.ssh"
      ]
    },
    {
      "type": "file",
      "source": "configs/sshd_config",
      "destination": "/etc/ssh/sshd_config"
    },
    {
      "type": "file",
      "source": "configs/authorized_keys",
      "destination": "/home/{{ env `USER` }}/.ssh/authorized_keys"
    }
  ]
}
